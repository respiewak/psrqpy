language: python
sudo: required
dist: xenial
branches:
  only:
    master
python:
  - "2.7"
  - "3.5"
  - "3.6"
  - "3.7"
before_install:
  # add a latex install for the matplotlib testing
  #- sudo apt-get -qq update && sudo apt-get install -y --no-install-recommends texlive-full
  # try a lighter weight texlive distribution, e.g. just texlive and texlive-latex-extra
  - sudo apt-get -qq update && sudo apt-get install -y --no-install-recommends texlive texlive-latex-extra
install:
  - pip install --upgrade pip
  - pip install -r requirements.txt
  # install additionally allowed packages
  - pip install matplotlib ads
  # install packages for documentation building
  - pip install sphinx sphinx-rtd-theme recommonmark
  # install packages for testing
  - pip install --upgrade pytest>=3.6.3
  - pip install pytest-cov pytest-socket
  - pip install codecov
  # build psrqpy
  - pip install -e .
before_script: # configure a headless display to test plot generation (see https://stackoverflow.com/a/35403128/1862861)
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
script:
  # run the test script
  - pytest --cov=psrqpy
  # try building documentation
  - cd docs
  - mkdir source/_static
  - make html
  # return to base directory
  - cd .. 
after_success:
  - codecov
